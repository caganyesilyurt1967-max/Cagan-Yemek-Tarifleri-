<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Çağan | Yemek Tarifleri</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: linear-gradient(270deg, #0ea5e9, #9333ea, #f59e0b, #10b981); background-size: 800% 800%; animation: gradientBG 20s ease infinite; color: #1e293b; display:flex; flex-direction:column; min-height:100vh; }
    @keyframes gradientBG { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
    header { background: rgba(0,0,0,0.6); color: white; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight:bold; }
    nav { background: #1e293b; color: white; padding: .8rem; text-align: center; display:none; }
    nav a { color: white; margin: 0 1rem; text-decoration: none; cursor:pointer; }
    main { padding: 1rem; max-width: 1000px; margin: auto; display:none; flex:1; }
    .filters { display:flex; gap:1rem; margin-bottom:1rem; justify-content:center; }
    select { padding:.4rem; border-radius:6px; }
    .recipe { background: white; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; box-shadow: 0 2px 6px rgba(0,0,0,.2); position:relative; }
    .recipe h2 { margin-top: 0; color: #0ea5e9; }
    .meta { font-weight:bold; margin:.3rem 0; }
    #search-container { width:100%; margin:1rem 0; }
    .visually-hidden { position:absolute; width:1px; height:1px; padding:0; overflow:hidden; clip:rect(0,0,0,0); border:0; }
    #search-input { width:100%; padding:.5rem; border-radius:8px; border:1px solid #ccc; font-size:1rem; }
    dialog{ border:none; border-radius:8px; padding:2rem; max-width:400px; width:90%; text-align:center; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
    dialog::backdrop{ background:rgba(0,0,0,.6) }
    input,textarea,select{width:100%;margin:.3rem 0;padding:.5rem;border-radius:6px;border:1px solid #ccc}
    button.primary{background:#0ea5e9;color:white;padding:.5rem 1rem;border:none;border-radius:6px;cursor:pointer;margin-top:.5rem}
    footer { background: #1e293b; padding: 1rem; text-align: center; color:white; margin-top:auto; }
    #adminPanel{display:none; padding:1rem; max-width:800px; margin:2rem auto; background:white; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.3);}
    table{width:100%; border-collapse:collapse; margin-top:1rem;}
    th, td{border:1px solid #ccc; padding:.5rem; text-align:left;}
    th{background:#0ea5e9; color:white;}
    #notification{ position:fixed; top:20px; right:20px; background:#10b981; color:white; padding:10px 20px; border-radius:5px; box-shadow:0 2px 10px rgba(0,0,0,.3); display:none; z-index:1000; }
  </style>
</head>
<body>
  <header>ÇAĞAN İLE YEMEK TARİFLERİ</header>
  <nav id="mainNav">
    <a data-cat="">Tümü</a>
    <a data-cat="anayemek">Ana Yemekler</a>
    <a data-cat="corba">Çorbalar</a>
    <a data-cat="tatli">Tatlılar</a>
    <a data-cat="meze">Mezeler</a>
    <a data-cat="icecek">İçecekler</a>
    <a id="favPage">⭐ Favorilerim</a>
    <a id="profilePage">👤 Profilim</a>
    <a id="logout" style="float:right;display:none;">Çıkış</a>
  </nav>

  <main id="content">
    <div id="search-container">
      <label for="search-input" class="visually-hidden">Search</label>
      <input id="search-input" type="text" name="text" placeholder="Tarif ara..." autocomplete="off" class="input" aria-label="Search" />
    </div>
    <div class="filters">
      <select id="filterZorluk">
        <option value="">Zorluk (Hepsi)</option>
        <option>Kolay</option>
        <option>Orta</option>
        <option>Zor</option>
      </select>
      <select id="filterVegan">
        <option value="">Vegan (Hepsi)</option>
        <option>Evet</option>
        <option>Hayır</option>
      </select>
      <select id="filterGluten">
        <option value="">Glutensiz (Hepsi)</option>
        <option>Evet</option>
        <option>Hayır</option>
      </select>
    </div>
    <div id="recipes"></div>
  </main>

  <dialog id="loginDialog" open>
    <h3>Oturum Aç / Kayıt Ol</h3>
    <form id="loginForm">
      <label>Kullanıcı Adı</label>
      <input name="username" required>
      <label>Şifre</label>
      <input name="password" type="password" required>
      <button class="primary" type="submit">Giriş Yap</button>
    </form>
    <button id="registerBtn" class="primary">Kayıt Ol</button>
    <button id="adminBtn" class="primary">Yönetici Girişi</button>
  </dialog>

  <dialog id="registerDialog">
    <h3>Kayıt Ol</h3>
    <form id="registerForm">
      <label>Kullanıcı Adı</label>
      <input name="username" required>
      <label>Şifre</label>
      <input name="password" type="password" required>
      <button class="primary" type="submit">Kaydol</button>
    </form>
    <button id="backToLogin" class="primary">Geri Dön</button>
  </dialog>

  <div id="adminPanel">
    <h3>Yönetici Paneli</h3>
    <p>Kullanıcılar ve yetkiler:</p>
    <table id="userTable">
      <thead><tr><th>Kullanıcı Adı</th><th>Yetki</th><th>Durum</th><th>İşlem</th></tr></thead>
      <tbody></tbody>
    </table>
    <hr>
    <h3>Tarif Yönetimi</h3>
    <form id="recipeForm">
      <input type="hidden" id="recipeId" />
      <label>Tarif Adı</label>
      <input name="title" required />
      <label>Kategori</label>
      <select name="cat" required>
        <option value="anayemek">Ana Yemekler</option>
        <option value="corba">Çorbalar</option>
        <option value="tatli">Tatlılar</option>
        <option value="meze">Mezeler</option>
        <option value="icecek">İçecekler</option>
      </select>
      <label>Süre (örn. 30 dk)</label>
      <input name="time" required />
      <label>Porsiyon (örn. 4 kişilik)</label>
      <input name="portion" required />
      <label>Zorluk</label>
      <select name="zorluk" required>
        <option>Kolay</option>
        <option>Orta</option>
        <option>Zor</option>
      </select>
      <label>Vegan</label>
      <select name="vegan" required>
        <option>Evet</option>
        <option>Hayır</option>
      </select>
      <label>Glutensiz</label>
      <select name="gluten" required>
        <option>Evet</option>
        <option>Hayır</option>
      </select>
      <label>Açıklama</label>
      <textarea name="desc" rows="3" required></textarea>
      <label>Malzemeler (virgülle ayırın)</label>
      <textarea name="ing" rows="3" required></textarea>
      <label>Yapılış Adımları (virgülle ayırın)</label>
      <textarea name="steps" rows="3" required></textarea>
      <button class="primary" type="submit">Tarifi Kaydet</button>
    </form>
  </div>

  <dialog id="profileDialog">
    <button onclick="document.getElementById('profileDialog').close()" style="float:right;">X</button>
    <h3>Profilim</h3>
    <p><b>Kullanıcı Adı:</b> <span id="profileName"></span></p>
    <p><b>Son Giriş:</b> <span id="lastLogin"></span></p>
    <p><b>Cihaz:</b> <span id="deviceInfo"></span></p>
    <form id="changePassForm">
      <label>Yeni Şifre</label>
      <input type="password" name="newpass">
      <button class="primary" type="submit">Şifre Değiştir</button>
    </form>
  </dialog>

  <div id="notification">✅ Favorilere eklendi!</div>

  <footer>© 2025 Çağan Yemek Tarifleri</footer>

<script>
const ADMIN_USERNAME = "Çağan", ADMIN_PASSWORD = "1234";
let users = JSON.parse(localStorage.getItem('users') || '[]');
let favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
let recipes = JSON.parse(localStorage.getItem('recipes') || `[
  { "id": 1, "cat": "anayemek", "title": "İskender Kebap", "desc": "Bursa'nın meşhur yemeği.", "time": "30 dk", "portion": "4 kişilik", "zorluk": "Orta", "vegan": "Hayır", "gluten": "Hayır", "ing": ["500g döner", "1 pide", "Yoğurt", "Sos"], "steps": ["Pide doğranır", "Üzerine et konur", "Yoğurt ve sos dökülür"] },
  { "id": 2, "cat": "corba", "title": "Mercimek Çorbası", "desc": "Geleneksel Türk mercimek çorbası.", "time": "20 dk", "portion": "4 kişilik", "zorluk": "Kolay", "vegan": "Hayır", "gluten": "Evet", "ing": ["1 su bardağı kırmızı mercimek", "1 soğan", "1 havuç", "Su"], "steps": ["Mercimekler haşlanır", "Sebzeler kavrulur", "Tüm malzemeler birleşir ve blenderdan geçirilir"] },
  { "id": 3, "cat": "tatli", "title": "Sütlaç", "desc": "Fırında üzeri kızarmış geleneksel tatlı.", "time": "45 dk", "portion": "6 kişilik", "zorluk": "Orta", "vegan": "Hayır", "gluten": "Evet", "ing": ["1 litre süt", "1 su bardağı pirinç", "1.5 su bardağı şeker", "1 yumurta sarısı"], "steps": ["Pirinçler haşlanır", "Süt ve şeker eklenir", "Kıvam alınca fırına verilir"] },
  { "id": 4, "cat": "meze", "title": "Haydari", "desc": "Nane ve sarımsaklı yoğurt mezesi.", "time": "10 dk", "portion": "2 kişilik", "zorluk": "Kolay", "vegan": "Hayır", "gluten": "Evet", "ing": ["1 kase süzme yoğurt", "2 diş sarımsak", "Nane", "Zeytinyağı"], "steps": ["Yoğurt çırpılır", "Sarımsak ezilir ve eklenir", "Nane ve zeytinyağı ile karıştırılır"] },
  { "id": 5, "cat": "anayemek", "title": "Spagetti Carbonara", "desc": "İtalyanların meşhur kremsiz makarnası.", "time": "25 dk", "portion": "2 kişilik", "zorluk": "Orta", "vegan": "Hayır", "gluten": "Hayır", "ing": ["200g spagetti", "100g pastırma veya bacon", "2 yumurta sarısı", "Parmesan peyniri"], "steps": ["Spagetti haşlanır", "Pastırma tavada kızartılır", "Yumurta sarısı ve peynir karıştırılır", "Haşlanmış spagettiye eklenip karıştırılır"] },
  { "id": 6, "cat": "icecek", "title": "Limonata", "desc": "Yaz aylarının vazgeçilmezi ev yapımı limonata.", "time": "15 dk", "portion": "4 kişilik", "zorluk": "Kolay", "vegan": "Evet", "gluten": "Evet", "ing": ["3 limon", "1 su bardağı şeker", "Su", "Nane yaprakları"], "steps": ["Limonlar sıkılır", "Şeker ve su ile karıştırılır", "Soğuk servis edilir"] }
]`);

const loginDialog = document.getElementById('loginDialog');
const loginForm = document.getElementById('loginForm');
const registerBtn = document.getElementById('registerBtn');
const registerDialog = document.getElementById('registerDialog');
const registerForm = document.getElementById('registerForm');
const backToLogin = document.getElementById('backToLogin');
const mainNav = document.getElementById('mainNav');
const adminBtn = document.getElementById('adminBtn');
const adminPanel = document.getElementById('adminPanel');
const logoutBtn = document.getElementById('logout');
const favPageBtn = document.getElementById('favPage');
const profilePageBtn = document.getElementById('profilePage');
const profileDialog = document.getElementById('profileDialog');
const changePassForm = document.getElementById('changePassForm');
const notification = document.getElementById('notification');

backToLogin.onclick = () => { registerDialog.close(); loginDialog.showModal(); };
profilePageBtn.onclick = () => { showProfile(); };
favPageBtn.onclick = () => { renderFavorites(); };
logoutBtn.onclick = () => { localStorage.removeItem('currentUser'); location.reload(); };

document.querySelectorAll('#mainNav a[data-cat]').forEach(link => {
    link.addEventListener('click', (e) => {
        const category = e.target.dataset.cat;
        renderRecipes(category ? recipes.filter(r => r.cat === category) : recipes);
    });
});

function getDevice() { return navigator.userAgent; }

loginForm.onsubmit = function (e) {
  e.preventDefault();
  const u = this.username.value;
  const p = this.password.value;
  const found = users.find(x => x.username === u && x.password === p);

  if (u === ADMIN_USERNAME && p === ADMIN_PASSWORD) {
    localStorage.setItem('currentUser', u);
    loginDialog.close();
    adminPanel.style.display = 'block';
    mainNav.style.display = 'block';
    logoutBtn.style.display = 'block';
    renderAdminPanel();
    return;
  }
  if (found) {
    if (found.isBlocked) {
      alert('Hesabınız engellenmiştir. Lütfen yöneticiyle iletişime geçin.');
      return;
    }
    localStorage.setItem('currentUser', u);
    localStorage.setItem(u + '_lastLogin', new Date().toLocaleString());
    localStorage.setItem(u + '_device', getDevice());
    loginDialog.close();
    mainNav.style.display = 'block';
    document.getElementById('content').style.display = 'block';
    logoutBtn.style.display = 'block';
    renderRecipes(recipes);
  } else {
    alert('Hatalı kullanıcı adı veya şifre');
  }
};

registerBtn.onclick = () => { loginDialog.close(); registerDialog.showModal(); };
registerForm.onsubmit = function (e) {
  e.preventDefault();
  const u = this.username.value;
  const p = this.password.value;
  if (users.find(x => x.username === u)) { alert('Kullanıcı zaten var'); return; }
  users.push({ username: u, password: p, isAdmin: false, isBlocked: false });
  localStorage.setItem('users', JSON.stringify(users));
  alert('Kayıt başarılı, lütfen giriş yapın.');
  registerDialog.close();
  loginDialog.showModal();
};

adminBtn.onclick = function () {
  let u = prompt('Yönetici Adı');
  let p = prompt('Yönetici Şifre');
  let adminUser = users.find(x => x.username === u && x.password === p && x.isAdmin);
  if ((u === ADMIN_USERNAME && p === ADMIN_PASSWORD) || adminUser) {
    if (adminUser && adminUser.isBlocked) {
      alert('Hesabınız engellenmiştir.');
      return;
    }
    localStorage.setItem('currentUser', u);
    loginDialog.close();
    adminPanel.style.display = 'block';
    mainNav.style.display = 'block';
    logoutBtn.style.display = 'block';
    renderAdminPanel();
  } else {
    alert('Hatalı yönetici bilgisi');
  }
};

function renderAdminPanel() {
  const tbody = document.querySelector('#userTable tbody');
  const currentUser = localStorage.getItem('currentUser');
  tbody.innerHTML = '';
  users.forEach(u => {
    const isPrimaryAdmin = u.username === ADMIN_USERNAME;
    const canChangeAdminStatus = currentUser === ADMIN_USERNAME && !isPrimaryAdmin;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${u.username}</td>
      <td>
        ${u.isAdmin ? 'Yönetici' : 'Kullanıcı'}
        ${canChangeAdminStatus ? `<button onclick="${u.isAdmin ? `removeAdmin('${u.username}')` : `addAdmin('${u.username}')`}">${u.isAdmin ? 'Yetkiyi Kaldır' : 'Yetki Ver'}</button>` : ''}
      </td>
      <td>
        ${u.isBlocked ? 'Engellendi' : 'Aktif'}
      </td>
      <td>
        ${u.username !== ADMIN_USERNAME ? `<button onclick="${u.isBlocked ? `unblockUser('${u.username}')` : `blockUser('${u.username}')`}">${u.isBlocked ? 'Engeli Kaldır' : 'Engelle'}</button>` : ''}
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function blockUser(username) {
  let user = users.find(u => u.username === username);
  if (user) { user.isBlocked = true; localStorage.setItem('users', JSON.stringify(users)); renderAdminPanel(); }
}
function unblockUser(username) {
  let user = users.find(u => u.username === username);
  if (user) { user.isBlocked = false; localStorage.setItem('users', JSON.stringify(users)); renderAdminPanel(); }
}
function addAdmin(username) {
  let user = users.find(u => u.username === username);
  if (user) { user.isAdmin = true; localStorage.setItem('users', JSON.stringify(users)); renderAdminPanel(); }
}
function removeAdmin(username) {
  let user = users.find(u => u.username === username);
  if (user) { user.isAdmin = false; localStorage.setItem('users', JSON.stringify(users)); renderAdminPanel(); }
}

const recipeForm = document.getElementById('recipeForm');
recipeForm.onsubmit = function (e) {
  e.preventDefault();
  const formData = new FormData(this);
  const newRecipe = Object.fromEntries(formData.entries());
  newRecipe.ing = newRecipe.ing.split(',').map(item => item.trim());
  newRecipe.steps = newRecipe.steps.split(',').map(item => item.trim());
  const recipeId = document.getElementById('recipeId').value;
  if (recipeId) {
    const index = recipes.findIndex(r => r.id == recipeId);
    if (index !== -1) { recipes[index] = { ...recipes[index], ...newRecipe }; }
  } else {
    newRecipe.id = Date.now();
    recipes.push(newRecipe);
  }
  localStorage.setItem('recipes', JSON.stringify(recipes));
  renderRecipes(recipes);
  this.reset();
  document.getElementById('recipeId').value = '';
};

function editRecipe(id) {
  const recipe = recipes.find(r => r.id === id);
  if (recipe) {
    document.getElementById('recipeId').value = recipe.id;
    recipeForm.title.value = recipe.title;
    recipeForm.cat.value = recipe.cat;
    recipeForm.time.value = recipe.time;
    recipeForm.portion.value = recipe.portion;
    recipeForm.zorluk.value = recipe.zorluk;
    recipeForm.vegan.value = recipe.vegan;
    recipeForm.gluten.value = recipe.gluten;
    recipeForm.desc.value = recipe.desc;
    recipeForm.ing.value = recipe.ing.join(', ');
    recipeForm.steps.value = recipe.steps.join(', ');
    window.scrollTo({ top: document.getElementById('adminPanel').offsetTop, behavior: 'smooth' });
  }
}
function deleteRecipe(id) {
  if (confirm('Bu tarifi silmek istediğinizden emin misiniz?')) {
    recipes = recipes.filter(r => r.id !== id);
    localStorage.setItem('recipes', JSON.stringify(recipes));
    renderRecipes(recipes);
  }
}

function addToFavorites(id) {
  const currentUser = localStorage.getItem('currentUser');
  if (!currentUser) { alert("Lütfen giriş yapın."); return; }
  if (!favorites[currentUser]) { favorites[currentUser] = []; }
  if (!favorites[currentUser].includes(id)) {
    favorites[currentUser].push(id);
    localStorage.setItem('favorites', JSON.stringify(favorites));
    showNotification();
  }
}

function showNotification() {
  notification.style.display = 'block';
  setTimeout(() => {
    notification.style.display = 'none';
  }, 2000);
}

function renderRecipes(list) {
  const currentUser = localStorage.getItem('currentUser');
  const isAdmin = users.find(u => u.username === currentUser)?.isAdmin || (currentUser === ADMIN_USERNAME);
  document.getElementById('recipes').innerHTML = list.map(r => `
    <div class="recipe">
      <h2>${r.title}</h2>
      <div class="meta">⏱ ${r.time} | 🍽 ${r.portion}</div>
      <p>${r.desc}</p>
      <p><b>Malzemeler:</b> ${r.ing.join(", ")}</p>
      <p><b>Yapılış:</b> ${r.steps.join(", ")}</p>
      <button onclick="addToFavorites(${r.id})">⭐ Favorilere Ekle</button>
      ${isAdmin ? `
        <button onclick="editRecipe(${r.id})">Düzenle</button>
        <button onclick="deleteRecipe(${r.id})">Sil</button>
      ` : ''}
    </div>
  `).join('');
}

function renderFavorites() {
  const currentUser = localStorage.getItem('currentUser');
  if (!currentUser) { alert("Lütfen giriş yapın."); return; }
  const userFavorites = favorites[currentUser] || [];
  const favRecipes = recipes.filter(r => userFavorites.includes(r.id));
  renderRecipes(favRecipes);
}

function showProfile() {
  const currentUser = localStorage.getItem('currentUser');
  if (!currentUser) { alert("Lütfen giriş yapın."); return; }
  document.getElementById('profileName').textContent = currentUser;
  document.getElementById('lastLogin').textContent = localStorage.getItem(currentUser + '_lastLogin') || 'Bilinmiyor';
  document.getElementById('deviceInfo').textContent = localStorage.getItem(currentUser + '_device') || 'Bilinmiyor';
  profileDialog.showModal();
}

changePassForm.onsubmit = function(e) {
  e.preventDefault();
  const currentUser = localStorage.getItem('currentUser');
  const newPass = this.newpass.value;
  if (currentUser === ADMIN_USERNAME) { alert("Ana yöneticinin şifresi değiştirilemez."); return; }
  let user = users.find(u => u.username === currentUser);
  if (user) {
    user.password = newPass;
    localStorage.setItem('users', JSON.stringify(users));
    alert("Şifreniz başarıyla değiştirildi.");
    profileDialog.close();
  }
};
</script>
</body>
</html>
